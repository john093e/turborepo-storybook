// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

generator client {
  provider = "prisma-client-js"
}

model ONG {
  id                        String           @id @unique @default(cuid())
  registered_name           String           @db.Text
  activated                 Boolean          @default(false)
  activated_at              DateTime?        @updatedAt
  activated_by              String?
  registered_charity_number String           @unique
  registered_address        String           @db.Text
  registered_postcode       Int
  registered_postcode_name  String           @db.Text
  account_name              String?
  address_set               String?
  address_line_2_set        String?
  address_city_set          String?
  address_country_set       String?
  address_state_set         String?
  address_postcode_set      Int?
  charity_number_set        String?          @unique
  dateFormat                String           @default("UTC+1")
  domain_name               String?
  fiscalYear                String?
  name_set                  String?          @unique
  postcode_name_set         String?
  sites                     Site[]
  B2E                       B2E[]
  Teams                     Teams[]
  PermissionSets            PermissionSets[]

  user User? @relation(fields: [activated_by], references: [id])

  @@index([activated_by])
}

model Teams {
  id           String  @id @unique @default(cuid())
  name         String
  ongId        String
  parentTeamId String?
  childTeam    Teams[] @relation(name: "management")
  B2E          B2E[]

  ong        ONG?   @relation(fields: [ongId], references: [id], onDelete: Cascade)
  parentTeam Teams? @relation(name: "management", fields: [parentTeamId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([ongId])
  @@index([parentTeamId])
}

model PermissionSets {
  id                                                    String  @id @unique @default(cuid())
  name                                                  String?
  ongId                                                 String
  accountOwner                                          Boolean
  editable                                              Boolean
  predefined                                            Boolean
  super_admin                                           Boolean
  //CRM
  crm_contacts_delete                                   Int
  crm_contacts_edit                                     Int
  crm_contacts_view                                     Int
  crm_companies_delete                                  Int
  crm_companies_edit                                    Int
  crm_companies_view                                    Int
  crm_deals_delete                                      Int
  crm_deals_edit                                        Int
  crm_deals_view                                        Int
  crm_tickets_delte                                     Int
  crm_tickets_edit                                      Int
  crm_tickets_view                                      Int
  crm_tasks_edit                                        Int
  crm_tasks_view                                        Int
  crm_notes_view                                        Int
  crm_custom_objects_delete                             Int
  crm_custom_objects_edit                               Int
  crm_custom_objects_view                               Int
  crm_workflows_delete                                  Boolean
  crm_workflows_edit                                    Boolean
  crm_workflows_view                                    Boolean
  crm_communicate                                       Int
  crm_bulk_delete                                       Boolean
  crm_import                                            Boolean
  crm_export                                            Boolean
  crm_edit_property_settings                            Boolean
  crm_chatflows                                         Boolean
  crm_customs_views                                     Boolean
  //Marketing
  marketing_lists_edit                                  Boolean
  marketing_lists_view                                  Boolean
  marketing_forms                                       Boolean
  marketing_files                                       Boolean
  marketing_marketing_access                            Boolean
  marketing_ads_publish                                 Boolean
  marketing_ads_view                                    Boolean
  marketing_campaigns_edit                              Boolean
  marketing_campaigns_view                              Boolean
  marketing_email_edit                                  Boolean
  marketing_email_publish                               Boolean
  marketing_email_view                                  Boolean
  marketing_social                                      Int
  marketing_content_staging                             Boolean
  marketing_blog_edit                                   Boolean
  marketing_blog_publish                                Boolean
  marketing_blog_view                                   Boolean
  marketing_landing_pages_edit                          Boolean
  marketing_landing_pages_publish                       Boolean
  marketing_landing_pages_view                          Boolean
  marketing_website_pages_edit                          Boolean
  marketing_website_pages_publish                       Boolean
  marketing_website_pages_view                          Boolean
  marketing_hubdb_edit                                  Boolean
  marketing_hubdb_publish                               Boolean
  marketing_hubdb_view                                  Boolean
  marketing_url_redirects_edit                          Boolean
  marketing_url_redirects_view                          Boolean
  marketing_design_tools                                Boolean
  //Sales
  sales_manage_product_library                          Boolean
  sales_create_custom_line_items                        Boolean
  sales_sales_access                                    Boolean
  sales_templates                                       Boolean
  sales_create_scheduling_pages_for_others              Boolean
  sales_sales_professional                              Boolean
  sales_forecast_edit                                   Int
  sales_forecast_view                                   Int
  sales_playbooks_edit                                  Boolean
  sales_playbooks_publish                               Boolean
  sales_playbooks_view                                  Boolean
  sales_sequences                                       Boolean
  sales_bulk_enroll_sequences                           Boolean
  sales_manage_payment_links                            Boolean
  sales_manage_payments_and_subscriptions               Boolean
  //Services
  service_service_access                                Boolean
  service_templates                                     Boolean
  service_create_scheduling_pages_for_others            Boolean
  //Reports
  reports_data_quality_tools_access                     Boolean
  reports_reports_access                                Boolean
  reports_dashboard_reports_and_analytics_create        Boolean
  reports_dashboard_reports_and_analytics_edit          Boolean
  reports_dashboard_reports_and_analytics_view          Boolean
  reports_marketing_reports                             Boolean
  //Account
  account_marketing_contacts_access                     Boolean
  account_app_marketplace_access                        Boolean
  account_asset_marketplace_access                      Boolean
  account_gdpr_delete_contacts                          Boolean
  account_hubdb_table_settings                          Boolean
  account_global_content_settings                       Boolean
  account_website_settings                              Boolean
  account_reports_and_dashboards                        Boolean
  account_domain_settings                               Boolean
  account_account_access                                Boolean
  account_add_and_edit_users                            Boolean
  account_add_and_edit_teams                            Boolean
  account_partition_by_teams                            Boolean
  account_presets                                       Boolean
  account_edit_account_defaults                         Boolean
  account_modify_billing_and_change_name_on_contract    Boolean
  account_add_and_edit_developer_apps_and_test_accounts Boolean
  account_user_table_access                             Boolean
  account_availability_management                       Boolean

  B2E B2E[]

  ong ONG? @relation(fields: [ongId], references: [id], onDelete: Cascade)

  @@index([ongId])
}

model B2E {
  id              String  @id @unique @default(cuid())
  ongId           String?
  userId          String?
  // role - 1: t-wol 2: Super Admin 3: Admin 4: Viewers 5: Analyst 6: Finance 7: Editeur 
  role            Int     @default(4)
  // Status - 1: pending 2:activate 3:blocked
  status          Int     @default(1)
  inUse           Boolean @default(true)
  defaultHomepage String  @default("dashboards")
  teamsId         String?

  user             User?           @relation(fields: [userId], references: [id], onDelete: Cascade)
  ong              ONG?            @relation(fields: [ongId], references: [id], onDelete: Cascade)
  teams            Teams?          @relation(fields: [teamsId], references: [id])
  PermissionSets   PermissionSets? @relation(fields: [permissionSetsId], references: [id])
  permissionSetsId String?

  @@index([userId])
  @@index([ongId])
  @@index([teamsId])
  @@index([permissionSetsId])
}

model User {
  id              String    @id @unique @default(cuid())
  name            String?
  dateFormat      String    @default("UTC+1")
  firstname       String?
  lastname        String?
  language        String?
  // if you are using Github OAuth, you can get rid of the username attribute (that is for Twitter OAuth)
  username        String?
  gh_username     String?
  email           String?   @unique
  emailVerified   DateTime?
  password        String?
  image           String?
  marketingAccept Boolean?
  phone           String?
  phonePrefix     String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  accounts        Account[]
  sessions        Session[]
  sites           Site[]
  B2E             B2E[]
  ONG             ONG[]
}

model Account {
  id                       String  @id @unique @default(cuid())
  userId                   String
  type                     String
  provider                 String
  providerAccountId        String
  refresh_token            String?
  refresh_token_expires_in Int?
  access_token             String?
  expires_at               Int?
  token_type               String?
  scope                    String?
  id_token                 String?
  session_state            String?
  oauth_token_secret       String?
  oauth_token              String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model Session {
  id           String   @id @unique @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Site {
  id            String   @id @unique @default(cuid())
  name          String?
  description   String?  @db.Text
  logo          String?
  image         String?  @db.Text
  imageBlurhash String?  @db.LongText
  subdomain     String?  @unique
  customDomain  String?  @unique
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  user          User?    @relation(fields: [userId], references: [id])
  userId        String?
  ong           ONG?     @relation(fields: [ongId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  ongId         String?
  posts         Post[]

  @@index([ongId])
  @@index([userId])
}

model Post {
  id            String   @id @unique @default(cuid())
  title         String?  @db.Text
  description   String?  @db.Text
  content       String?  @db.LongText
  slug          String   @default(cuid())
  image         String?  @db.Text
  imageBlurhash String?  @db.LongText
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  published     Boolean  @default(false)
  site          Site?    @relation(fields: [siteId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  siteId        String?

  @@unique([id, siteId], name: "post_site_constraint")
  @@index([siteId])
}

model Example {
  id            Int     @id @default(autoincrement())
  name          String?
  description   String? @db.Text
  domainCount   Int?
  url           String?
  image         String? @db.Text
  imageBlurhash String? @db.LongText
}
